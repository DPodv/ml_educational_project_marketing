# Проект Яндекс Мастерской "Макретинг".
В рамках данного проекта для интернет-магазина мы осуществляем анализ исторической информации о покупках и коммуникации с клиентами, чтобы идентифицировать пользователей, проявляющих интерес и готовых совершить покупку в ближайшие 90 дней. Данные нашего исследования охватывают период с мая 2022 года по февраль 2024 года. Эффективная идентификация таких клиентов поможет заказчику улучшить планирование будущих маркетинговых кампаний.
Данные представлены тремя даттасетами:

**Цель**
Предсказать вероятность покупки в течение 90 дней.

`purchases` - данные о покупках клиентов
- `client_id` идентификатор пользователя;
- `quantity` количество товаров в заказе;
- `price` цена товара;
- `category_ids` вложенные категории, к которым отнсится товар;
- `date` дата покупки;
- `message_id` идентификатор сообщения из рассылки.

`messages` - данные о коммуникации с клиентами
- `bulk_campaign_id` идентификатор рекламной кампании;
- `client_id` идентификатор пользователя;
- `message_id` идентификатор сообщений;
- `event` тип действия;
- `channel` канал рассылки;
- `date` дата рассылки;
- `created_at` точное время создания сообщения.

`target` - данные со значениями целевого признака
- `client_id` идентификатор пользователя;
- `target` целевой признак.

## Предварительная обработка данных.

В ходе предварительной обработки мы столкнулись с некачественными данными: большим количеством дубликатов в датасете `purchases`, точная идентификация которых была затруднена отсутствием точного времени создания заказа и данных о его конечном статусе (получен/отказ/возврат). Учитывая системность проблемы (дубликаты составляли 36.1% от всего набора данных, мы избавились от всех дублирующихся наблюдений, за исключением данных о тех клиентах, которые неоднократно совершали несколько однотипных заказов в один день, вероятно, настраивая таким образом конечное количество единиц товара. Обработалт дубликаты в датасете `messages`, а также столкнулись с наличием ряда категорий признака `event`, которые описываю нерелевантные для задачи действия с сообщением, которые мы объединили в одну категорию.

## Исследовательский анализ.

Исследовательский анализ позволил выявить следующие особенности данных:
- **Целевой признак :** значительный дисбаланс обучающих данных по целевому признаку (соотношение классов 98:2);
- **Данные о покупках :** большая часть клиентов совершали однократные покупки, при этом, часть из них регулировала итоговое количество единиц товара через повторные заказы. Товары чаще всего стоили не более 3800 у.е., при этом часть наблюдений составляли более дорогостоящие покупки. Мы проанализировали средние и медианные значения цен для каждого значения количества единиц товара в заказе и не обнаружили там явных выбросов (объемных закупок дорогостоящими товарами). В связи с этим данные, статистически относящиеся к выбросам по каждому признаку в отдельности, мы сочли релевантными для дальнейшего обучения модели. Также мы проанализировали данные признака `category_ids` и укрупнили категории. Наиболее популярная категория товаров среди всех клиентов - "4". 
- **Данные о коммуникации:**  мы обнаружили низкие значения конверсии покупок к отправленным сообщениям, которая составляет 0.6%, при этом коэффициент открытых сообщений достаточно высок, однако далее на кадждом этапе компания теряет заинтересованность потенциальных покупателей. Значение конверсии различается в зависимости от канала коммуникации, наиболее прибыльными являются рассылкаи по каналу email, однако с потенциальным возвращением клиента к сервису больше связан канал "mobile_push". Выявили номера id наиболее успешных рекламных кампаний. По результатам исследования зависимости целевого признака от данных датасета мы заключили, что количество различных действий с сообщением может стать полезной информацией для предсказания целевого признака.

## Агрегация данных.
Мы объединили и агрегировали данные для каждого уникального клиента и добавили новые синтетические признаки: количество дней между первым и последним заказом, частота покупок, количество дней, прошедших с момента последней покупки, количество дней, прошедших с момента последней коммуникации, бинарный признак с информацией о том, совершал ли клиент покупку после последней коммуникации, количество действий ("open", "click" и т.д.) клиента с сообщением, количество товаров к различных категориях, приобретенных клиентом.

## Корреляционный анализ.
Мы оценили значения корелляции фи-к: не обнаружили значимой связи между целевой переменной и обучающими признаками, мультиколлинеарность также отсутствовала.

## Обучение моделей.

Для обучения мы выбрали бустинговые модели основанные на деревьях решений: CatBoostClassifier и LGBMClassifier - они быстро обучаются на большом количестве данных и имеют встроенные методы учета дисбаланса классов. Обе модели обучались методом кросс-валидации со стратифицированным разделением на блоки и подбором гиперпараметров. Для проверки качества обученных моделей использовали метрику roc-auc - именно она интересовала заказчика, и, дополнительно, оценивали с помощью f1-меры.

Обе модели качественно обучились, значения roc-auc моделей на кросс-валидации и на тестовом наборе данных близки и составляют около 0.75. Однако способность обеих моделей различать оба класса(F1-мера) очень низкая. Мы попробовали улучшить качество модели, изменив порог принятия решений, однако донастроенные модели не отвечали требованиям заказчика определить готовых к покупке клиентов. Для итогового предсказания мы использовали модель CatBoost, ее точность на тестовых данных составила 0.77, при этом модель ошибочно причисляет часть клиентов, которые не вернутся за покупками к целевому для заказчика классу. 

## Оценка важности признаков.

Наиболее важными для модели стали показатели количества переходов по ссылкам, количество дней с момента последнего заказа и цена последнего заказа. Анализ SHAP-значений выявил следующие закономерности в поведении исследуемых категорий клиентов:

*Клиенты, которые вернутся:* обычно активны более 100 дней, имеют интервал с последнего заказа менее 200 дней и среднюю стоимость покупок ниже 2500 у.е. Они часто выбирают товары категории "4" и проявляют интерес к рекламным сообщениям, открывая их около 200 раз и переходя по ссылкам более 50 раз, хотя редко покупают по предложениям.

*Клиенты, которые не вернутся:* их покупки, как правило, редкие и дорогие, товары часто принадлежат категории "2". Они менее активно взаимодействуют с рекламными рассылками и нередко отписываются.

## Рекомендации для заказчика.

По результатам анализа исходных данных и стратегии модели в принятии решений, можно выделить следующие рекомендации:

1) Проанализировать возможные причины снижения конверсии на каждом последующем шаге после отправки рекламного сообщения.
2) Поскольку email-рассылки показывают высокую эффективность, они могут послужить опорным методом удержания клиентов, при этом следует обратить внимание на эффективность канала push-уведомлений, именно с ним связано большее число клиентов, которые возвращаются за покупками. В данном контексте можно учесть высокую популярность товаров категории "4", т.к. именно за ней чаще всего возвращаются клиенты.
3) Провести дополнительны анализ успешных рекламных кампаний (id "7803", "4679" и "12218") для выявления наиболее эффективных подходов в контенте и времени рассылок.
4) Настроить сбор обратной связи у клиентов, которые не открывают сообщения или часто отписываются, чтобы понять причины низкой заинтересованности. Также обратить внимание на понятность и удобство пользования сервисом, чтобы минимизировать оформление однотипных заказов.

### Заключение

Проект позволил выделить ключевые аспекты, которые связывают поведение клиентов интернет-магазина и их ретенцию, и разработать рекомендации для повышения конверсии и удержания клиентов.
